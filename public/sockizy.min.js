"use strict";function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},_slicedToArray=function(){function e(e,t){var r=[],n=!0,i=!1,o=void 0;try{for(var a,s=e[Symbol.iterator]();!(n=(a=s.next()).done)&&(r.push(a.value),!t||r.length!==t);n=!0);}catch(e){i=!0,o=e}finally{try{!n&&s.return&&s.return()}finally{if(i)throw o}}return r}return function(t,r){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return e(t,r);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),_createClass=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),io=function(e){function t(e){if(null===e)return"";switch(void 0===e?"undefined":_typeof(e)){case"string":return e;case"undefined":return"";case"boolean":return e?"true":"false";case"number":return isNaN(e)?"":e+"";case"symbol":return e.toString();default:return JSON.stringify(e)}}var r=function(){function e(e,t,r){if(t)e.call(r);else for(var n=0,i=e.length;n<i;++n)e[n].call(r)}function t(e,t,r,n){if(t)e.call(r,n);else for(var i=0,o=e.length;i<o;++i)e[i].call(r,n)}function r(e,t,r,n,i){if(t)e.call(r,n,i);else for(var o=0,a=e.length;o<a;++o)e[o].call(r,n,i)}function n(e,t,r,n,i,o){if(t)e.call(r,n,i,o);else for(var a=0,s=e.length;a<s;++a)e[a].call(r,n,i,o)}function i(e,t,r,n,i,o,a){if(t)e.call(r,n,i,o,a);else for(var s=0,c=e.length;s<c;++s)e[s].call(r,n,i,o,a)}function o(e,t,r,n){if(t)e.apply(r,n);else for(var i=0,o=e.length;i<o;++i)e[i].apply(r,n)}return function(){function a(){_classCallCheck(this,a),this._events=Object.create(null)}return _createClass(a,[{key:"on",value:function(e,t){var r=this._events[e];return this._events[e]="function"==typeof r?[r,t]:r?this._arrayCloneWith(r,r.length,t):t,this}},{key:"off",value:function(e,t){var r=arguments.length;if(!r)return this._events=Object.create(null),this;var n=this._events[e];if("function"==typeof n)return 1!==r&&n!==t||(this._events[e]=null),this;var i=n&&n.length;return i?(1===r?1===i?n.pop():this._events[e]=new Array:1===i?n[0]===t&&n.pop():n.indexOf(t)>=0&&(this._events[e]=this._arrayCloneWithout(n,i,t)),this):this}},{key:"listenerCount",value:function(e){var t=this._events;if(t){var r=t[e];if("function"==typeof r)return 1;if(r)return r.length}return 0}},{key:"_emit",value:function(a){var s=this._events[a];if(!s){if("error"===a){var c=arguments[1];if(c instanceof Error)throw c;var u=new Error('Unhandled "error" event. ('+c+")");throw u.context=c,u}return!1}var f="function"==typeof s,l=arguments.length;switch(l){case 1:e(s,f,this);break;case 2:t(s,f,this,arguments[1]);break;case 3:r(s,f,this,arguments[1],arguments[2]);break;case 4:n(s,f,this,arguments[1],arguments[2],arguments[3]);break;case 5:i(s,f,this,arguments[1],arguments[2],arguments[3],arguments[4]);break;default:for(var y=new Array(l-1),h=1;h<l;++h)y[h-1]=arguments[h];o(s,f,this,y)}return!0}},{key:"_arrayCloneWithout",value:function(e,t,r){for(var n=new Array(t-1),i=void 0,o=0;t--;)r!==(i=e[t])&&(n[o]=i,++o);return n}},{key:"_arrayCloneWith",value:function(e,t,r){var n=new Array(t+1);for(n[t]=r;t--;)n[t]=e[t];return n}}]),a}()}();e.exports=r;var n=function(){function e(e,t,c){function u(e,t){for(var n=Array.isArray(t),c=void 0,u=h,f=o,l=void 0,_=void 0,w=void 0,E=void 0,k=void 0,S=void 0,C=void 0,N=void 0,O=void 0;u--;){l=p[u];var U=_slicedToArray(l,7);if(_=U[0],w=U[1],E=U[2],k=U[3],S=U[4],C=U[5],N=U[6],O=y?t:t[n?u:_],w&(A|m)?(w&T&&(O=JSON.stringify(O)),O?(E+=C[0]=w&A?r(O,k,E,O.byteLength):k.write(O,E),S=k,k._blen=E,i?(k[0]=N[1],k[1]=N[0]):(k[0]=N[0],k[1]=N[1])):S=d):null===O||isNaN(O)||!isFinite(O)||void 0===O?k[0]=0:(k[0]=O,i&&k.byteLength>1&&S.reverse()),b)for(c=0;E--;)b[f++]=S[c++];else v[u]=S,f+=E}var L=b;if(!L)for(L=g&&g.length===f?g:g=new Uint8Array(f),u=h,c=o;u--;)for(var M=v[u],B=0,P=M._blen||M.length;B<P;++B)L[c++]=M[B];return a[0]=e,L[0]=s[0],L[1]=s[1],L}function f(e,r,a,s,u){if(!h)return s&&s(o),null;if(!(!e||"object"!==(void 0===e?"undefined":_typeof(e))||b&&e.byteLength!==w||e.byteLength<w)){y||(u=u||(c?t?new Array:Object.create(null):_));for(var f=void 0,l=h,v=void 0,d=void 0,E=void 0,g=void 0,k=void 0,S=void 0,C=void 0,N=r+o,O=N;l--;){var U=_slicedToArray(p[l],7);v=U[0],d=U[1],E=U[2],g=U[3],k=U[4],S=U[5],C=U[6];for(var L=0;L<E;++L){if(N>=a)return;S?C[L]=e[N++]:k[L]=e[N++]}if(d&(A|m)){i&&C.reverse();var M=S[0];if(!M||M>=a)f=d&(A|T)?null:"";else{for(var B=Math.min(g.length-E,a,M),P=d&A?n.alloc(B):g,I=0;I<B;++I,++N)P[I]=e[N];if(f=d&A?P:P.toString("utf8",0,B),d&T)try{f=JSON.parse(f)}catch(e){f=null}}}else i&&g.byteLength>1&&k.reverse(),f=g[0];y?u=f:(t&&(v=l),u[v]=f)}return s&&s(o+N-O),u}}e||(e=[]);for(var l,y="string"==typeof e,h=y?1:e.length,p=new Array(h),v=new Array(h),d=new Uint8Array(2),_=t?new Array:Object.create(null),w=0,E=!1,b=null,g=null,A=1,m=2,k=4,S=8,C=16,T=32,N=0;N<h;++N){var O=(l=y?["",e]:e[N].split(":")).shift(),U=l.shift(),L=function(e){switch(e){case"b":case"bin":return A;case"j":case"json":return m|T;case"s":case"str":return m;case"i":case"int":return k;case"u":case"uint":return S;case"f":case"float":return C;default:throw new Error("Unknown type: "+e)}}(U.replace(/[\d\[\]]/g,"")),M=function(e,t){if(e&A)return[Uint16Array.BYTES_PER_ELEMENT,n.alloc((t||1024)+Uint16Array.BYTES_PER_ELEMENT),new Uint16Array(1)];if(e&T)return[Uint16Array.BYTES_PER_ELEMENT,n.alloc((t||8192)+Uint16Array.BYTES_PER_ELEMENT),new Uint16Array(1)];if(e&m)return[Uint16Array.BYTES_PER_ELEMENT,n.alloc((t||256)+Uint16Array.BYTES_PER_ELEMENT),new Uint16Array(1)];switch(e){case k:switch(t){case 8:return[Int8Array.BYTES_PER_ELEMENT,new Int8Array(1)];case 16:return[Int16Array.BYTES_PER_ELEMENT,new Int16Array(1)];case 32:return[Int32Array.BYTES_PER_ELEMENT,new Int32Array(1)];default:throw new Error("Unknown size: "+t)}case S:switch(t){case 8:return[Uint8Array.BYTES_PER_ELEMENT,new Uint8Array(1)];case 16:return[Uint16Array.BYTES_PER_ELEMENT,new Uint16Array(1)];case 32:return[Uint32Array.BYTES_PER_ELEMENT,new Uint32Array(1)];default:throw new Error("Unknown size: "+t)}case C:switch(t){case 32:return[Float32Array.BYTES_PER_ELEMENT,new Float32Array(1)];case 64:return[Float64Array.BYTES_PER_ELEMENT,new Float64Array(1)];default:throw new Error("Unknown size: "+t)}default:throw new Error("Unknown type: "+e)}}(L,parseInt(U.replace(/\D/g,""),10)||0),B=_slicedToArray(M,3),P=B[0],I=B[1],j=B[2],R=L&(A|m)?null:new Uint8Array(I.buffer),Y=j?new Uint8Array(j.buffer):null;p[N]=[O,L,P,I,R,j,Y],w+=P,!E&&L&(A|m)&&(E=!0)}return w+=o,E||(b=new Uint8Array(w)),{pack:u,unpack:f}}function t(e){return s[0]=e[0],s[1]=e[1],i&&s.reverse(),a[0]}function r(e,t,r,n){var i=void 0;for(i=0;i<n&&!(i+r>=t.byteLength||i>=e.byteLength);++i)t[i+r]=e[i];return i}var n="undefined"!=typeof Buffer?Buffer:function(){function e(e,t){t=t||1/0;for(var r=e.length,n=void 0,i=null,o=new Array,a=0;a<r;++a){if((n=e.charCodeAt(a))>55295&&n<57344){if(!i){if(n>56319){(t-=3)>-1&&o.push(239,191,189);continue}if(a+1===r){(t-=3)>-1&&o.push(239,191,189);continue}i=n;continue}if(n<56320){(t-=3)>-1&&o.push(239,191,189),i=n;continue}n=65536+(i-55296<<10|n-56320)}else i&&(t-=3)>-1&&o.push(239,191,189);if(i=null,n<128){if((t-=1)<0)break;o.push(n)}else if(n<2048){if((t-=2)<0)break;o.push(n>>6|192,63&n|128)}else if(n<65536){if((t-=3)<0)break;o.push(n>>12|224,n>>6&63|128,63&n|128)}else{if(!(n<1114112))throw new Error("Invalid code point");if((t-=4)<0)break;o.push(n>>18|240,n>>12&63|128,n>>6&63|128,63&n|128)}}return o}function t(e,t,r){r=Math.min(e.length,r);for(var n=new Array,i=t;i<r;){var o=e[i],a=null,s=o>239?4:o>223?3:o>191?2:1;if(i+s<=r){var u=void 0,f=void 0,l=void 0,y=void 0;switch(s){case 1:o<128&&(a=o);break;case 2:128==(192&(u=e[i+1]))&&(y=(31&o)<<6|63&u)>127&&(a=y);break;case 3:u=e[i+1],f=e[i+2],128==(192&u)&&128==(192&f)&&(y=(15&o)<<12|(63&u)<<6|63&f)>2047&&(y<55296||y>57343)&&(a=y);break;case 4:u=e[i+1],f=e[i+2],l=e[i+3],128==(192&u)&&128==(192&f)&&128==(192&l)&&(y=(15&o)<<18|(63&u)<<12|(63&f)<<6|63&l)>65535&&y<1114112&&(a=y)}}null===a?(a=65533,s=1):a>65535&&(a-=65536,n.push(a>>>10&1023|55296),a=56320|1023&a),n.push(a),i+=s}return c(n)}function n(e){if(e>f)throw new RangeError("Invalid typed array length");var t=new Uint8Array(e);return t.write=l.prototype.write,t.toString=l.prototype.toString,t}function i(t){return e(t).length}function o(e){return n(e)}function a(t,n,i){n=n||0,i=i||this.length;var o=this.length-n;return(!i||i>o)&&(i=o),r(e(t,this.length-n),this,n,i)}function s(e,r,n){return r=r||0,n=n||this.length,0===n?"":t(this,r,n)}function c(e){var t=e.length;if(t<=u)return String.fromCharCode.apply(String,e);for(var r="",n=0;n<t;)r+=String.fromCharCode.apply(String,e.slice(n,n+=u));return r}var u=4096,f=2147483647,l=function(){};return l.alloc=o,l.byteLength=i,l.prototype=Object.create(null),l.prototype.write=a,l.prototype.toString=s,l}(),i=function(){var e=new Uint32Array([305419896]);return 18===new Uint8Array(e.buffer,e.byteOffset,e.byteLength)[0]}(),o=2,a=new Uint16Array(1),s=new Uint8Array(a.buffer);return{isBigEndian:i,createPacket:e,getId:t}}();return e.exports=n,e.exports=t,function(e){function i(e,t){function r(e){s+=e}var i=this,o=t.data;if(e._emit("message",o,t),"string"!=typeof o){if(!e._emit("arraybuffer",o,t))for(var a=(o=new Uint8Array(o)).byteLength,s=0,c=o;s<a&&"break"!==function(){var t=i._unpackMapById[n.getId(c)];if(!t)return"break";var u=_slicedToArray(t,2),f=u[0],l=u[1].unpack(c,s,a,r);if(void 0===l)return"break";a>s&&(c=o.slice(s)),e.listenerCount("packet")?e._emit("packet",f,l,function(){return e._emit(f,l)}):e._emit(f,l),e._emit("packet",f,l),e._emit(f,l)}(););}else if(e._emit("text",o,t),e.listenerCount("json")){try{o=JSON.parse(o)}catch(e){o=void 0}void 0!==o&&e._emit("json",o,t)}}function o(e,t){var r=this._reconnectionAttemptsCount;this._reconnectionAttemptsCount=0,this.reconnecting&&(this.reconnecting=!1,e._emit("restored",r)),e._emit("open")}function a(e,t){var r=this,n=t.code,i=t.reason;if(e._emit("close",n,i,t),t.wasClean)e._emit("disconnected",n,i,t);else{var o=this._reconnectionAttemptsCount;e._emit("terminated",n,t),o<this._reconnectionAttempts?(this._reconnectionAttemptsCount++,setTimeout(function(){r.reconnecting=!0,r._reconnect(),e._emit("restoring",o)},this._reconnectionDelay)):(this.reconnecting=!1,e._emit("unrestored",o))}}function s(e,t){e._emit("error",t)}function c(){return crypto?function(){return([1e7]+-1e3+-4e3+-8e3+-1e11).replace(/[018]/g,function(e){return(e^crypto.getRandomValues(new Uint8Array(1))[0]&15>>e/4).toString(16)})}():function(){function e(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)}return e()+e()+"-"+e()+"-"+e()+"-"+e()+"-"+e()+e()+e()}()}var u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},f=window.WebSocket||window.MozWebSocket;return Uint8Array.prototype.slice||Object.defineProperty(Uint8Array.prototype,"slice",{value:Array.prototype.slice}),new(function(r){function l(){_classCallCheck(this,l);var t=_possibleConstructorReturn(this,(l.__proto__||Object.getPrototypeOf(l)).call(this));if(t._reconnectionDelay=1e3*Math.max(1,u.reconnectionDelay||0),t._reconnectionAttempts=u.reconnectionAttempts||1/0,t._reconnectionAttemptsCount=0,t._packMapByName=new Map,t._unpackMapById=new Array,t._id=c(),t.reconnecting=!1,t.CONNECTING=f.CONNECTING,t.OPEN=f.OPEN,t.CLOSING=f.CLOSING,t.CLOSED=f.CLOSED,e){var r=e.trim().split(/(^wss?:\/\/)/i),n=r.pop().replace(/^[:\/\/]*/,""),i=(r.pop()||"").trim(),o=!(!i||!i.match(/^wss:\/\//i)),a=u.secure;void 0===a&&(a=i?o:!!document.location.protocol.match(/^https/i)),t._connect((a?"wss":"ws")+"://"+n+"/?id="+t._id)}return t}return _inherits(l,r),_createClass(l,[{key:"isSupported",value:function(){return void 0!==f}},{key:"emit",value:function(e,t){return(t=this._pack(e,t))&&this.send(t),!!t}},{key:"text",value:function(e){this.send(t(e))}},{key:"json",value:function(e){this.send(JSON.stringify(e))}},{key:"send",value:function(e){var t=this.readyState,r=void 0;try{t!==this.CLOSING&&t!==this.CLOSED?this._ws.send(e):r=new Error("WebSocket is already in CLOSING or CLOSED state.")}catch(e){r=e}r&&this._emit("error",r)}},{key:"disconnect",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1e3,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",r=this.readyState;return r!==this.CLOSING&&r!==this.CLOSED&&this._ws.close(e,t),this}},{key:"packets",value:function(){function e(e,r){e&&Object.keys(e).forEach(function(i){var o=i.split(/\(([\[\{]?)(\@?)([\}\]]?)\)$/),a=void 0,s=void 0,c=void 0,u=void 0;a=o.shift().trim(),s="["===o.shift(),c="@"===o.shift(),u=e[i],t(a),r(a,n.createPacket(u,s,c))})}function t(e){if(["restoring","restored","open","close","disconnected","terminated","packet","message","arraybuffer","error","ping","pong"].some(function(t){return t===e}))throw new Error("Used a reserved name: "+e)}for(var r=this,i=arguments.length,o=Array(i),a=0;a<i;a++)o[a]=arguments[a];var s=void 0,c=void 0,u=void 0,f=void 0;return"string"==typeof arguments[0]?(s=o[0],u=o[1],c=o[2],f=o[3]):(u=o[0],c=o[1],f=o[2]),s=s?s+".":"",e(c,function(e,t){r._unpackMapById.push([s+e,t])}),e(u,function(e,t){r._packMapByName.set(s+e,[r._packMapByName.size,t])}),f?this.packets(f,f):this}},{key:"_connect",value:function(e){var t=this._ws=new f(e);t.onmessage=i.bind(t,this),t.onopen=o.bind(t,this),t.onclose=a.bind(t,this),t.onerror=s.bind(t,this),t.binaryType="arraybuffer"}},{key:"_reconnect",value:function(){this._connect(this.url)}},{key:"_pack",value:function(e,t){var r=this._packMapByName.get(e);if(!r)return null;var n=_slicedToArray(r,2),i=n[0];return n[1].pack(i,t)}},{key:"bufferedAmount",get:function(){return this._ws&&this._ws.bufferedAmount||0}},{key:"readyState",get:function(){return this._ws&&this._ws.readyState||this.CLOSED}},{key:"url",get:function(){return this._ws&&this._ws.url||""}}]),l}(r))}}({});