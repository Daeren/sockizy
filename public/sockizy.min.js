"use strict";function _possibleConstructorReturn(e,r){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!r||"object"!=typeof r&&"function"!=typeof r?e:r}function _inherits(e,r){if("function"!=typeof r&&null!==r)throw new TypeError("Super expression must either be null or a function, not "+typeof r);e.prototype=Object.create(r&&r.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),r&&(Object.setPrototypeOf?Object.setPrototypeOf(e,r):e.__proto__=r)}function _classCallCheck(e,r){if(!(e instanceof r))throw new TypeError("Cannot call a class as a function")}var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},_slicedToArray=function(){function e(e,r){var t=[],n=!0,i=!1,a=void 0;try{for(var o,u=e[Symbol.iterator]();!(n=(o=u.next()).done)&&(t.push(o.value),!r||t.length!==r);n=!0);}catch(e){i=!0,a=e}finally{try{!n&&u.return&&u.return()}finally{if(i)throw a}}return t}return function(r,t){if(Array.isArray(r))return r;if(Symbol.iterator in Object(r))return e(r,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),_createClass=function(){function e(e,r){for(var t=0;t<r.length;t++){var n=r[t];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(r,t,n){return t&&e(r.prototype,t),n&&e(r,n),r}}(),io=function(e){var r=function(){function e(e,r,t){if(r)e.call(t);else for(var n=0,i=e.length;n<i;++n)e[n].call(t)}function r(e,r,t,n){if(r)e.call(t,n);else for(var i=0,a=e.length;i<a;++i)e[i].call(t,n)}function t(e,r,t,n,i){if(r)e.call(t,n,i);else for(var a=0,o=e.length;a<o;++a)e[a].call(t,n,i)}function n(e,r,t,n,i,a){if(r)e.call(t,n,i,a);else for(var o=0,u=e.length;o<u;++o)e[o].call(t,n,i,a)}function i(e,r,t,n){if(r)e.apply(t,n);else for(var i=0,a=e.length;i<a;++i)e[i].apply(t,n)}return function(){function a(){_classCallCheck(this,a),this._events={}}return _createClass(a,[{key:"on",value:function(e,r){var t=this._events[e];return this._events[e]="function"==typeof t?[t,r]:t?this._arrayCloneWith(t,t.length,r):r,this}},{key:"off",value:function(e,r){var t=arguments.length;if(!t)return this._events={},this;var n=this._events[e];if("function"==typeof n)return 1!==t&&n!==r||(this._events[e]=null),this;var i=n&&n.length;return i?(1===t?1===i?n.pop():this._events[e]=new Array:1===i?n[0]===r&&n.pop():n.indexOf(r)>=0&&(this._events[e]=this._arrayCloneWithout(n,i,r)),this):this}},{key:"_emit",value:function(a){var o=this._events[a];if(!o){if("error"===a){var u=arguments[1];if(u instanceof Error)throw u;var c=new Error('Unhandled "error" event. ('+u+")");throw c.context=u,c}return!1}var s="function"==typeof o,f=arguments.length;switch(f){case 1:e(o,s,this);break;case 2:r(o,s,this,arguments[1]);break;case 3:t(o,s,this,arguments[1],arguments[2]);break;case 4:n(o,s,this,arguments[1],arguments[2],arguments[3]);break;default:for(var l=new Array(f-1),y=1;y<f;++y)l[y-1]=arguments[y];i(o,s,this,l)}return!0}},{key:"_arrayCloneWithout",value:function(e,r,t){for(var n=new Array(--r),i=void 0;r--;)t!==(i=e[r])&&(n[r]=i);return n}},{key:"_arrayCloneWith",value:function(e,r,t){for(var n=new Array(r+1);r--;)n[r]=e[r];return n[r]=t,n}}]),a}()}();e.exports=r;var t=function(){function e(e){function r(e,r){for(var t=Array.isArray(r),a=void 0,o=u,l=i;o--;){var y=c[o],h=_slicedToArray(y,7),_=h[0],w=h[1],b=(h[2],h[3]),g=h[4],k=h[5],E=h[6],A=r[t?o:_];switch(w){case d:if(!A){g=f;break}var m=k.byteLength,S=A?b.write(A,m):0;for(k[0]=S,n?(b[0]=E[1],b[1]=E[0]):(b[0]=E[0],b[1]=E[1]),S+=m,g&&g.length===S||(g=y[4]=new Uint8Array(S));S--;)g[S]=b[S];break;default:b[0]=A,n&&b.byteLength>1&&g.reverse()}var T=g.length;if(p)for(a=0;T--;)p[l++]=g[a++];else s[o]=g,l+=T}var U=p;if(!U)for(U=v&&v.length===l?v:v=new Uint8Array(l),o=u,a=i;o--;)for(var C=s[o],B=0,M=C.length;B<M;++B)U[a++]=C[B];return U[0]=e,U}function a(e,r,t,a,o){if(o=o||l,!e||"object"!==(void 0===e?"undefined":_typeof(e))||!h&&e.byteLength!==y||e.byteLength<y)return null;if(!u)return a&&a(i),o;for(var s=void 0,f=u,p=void 0,v=void 0,_=void 0,w=void 0,b=void 0,g=void 0,k=void 0,E=r+i,A=E;f--;){s=c[f];var m=_slicedToArray(s,7);p=m[0],v=m[1],_=m[2],w=m[3],b=m[4],g=m[5],k=m[6];for(var S=0;S<_;++S){if(E>=t)return null;g?k[S]=e[E++]:b[S]=e[E++]}switch(v){case d:n&&k.reverse();var T=g[0];if(!T||T>=t)o[p]="";else{for(var U=Math.min(w.length,T),C=0;C<U;++C)w[C]=e[E++];o[p]=w.toString("utf8",0,U)}break;default:n&&w.byteLength>1&&b.reverse(),o[p]=w[0]}}return a&&a(i+E-A),o}Array.isArray(e)||(e=new Array);for(var o,u=e.length,c=new Array(u),s=new Array(u),f=new Uint8Array(2),l=Object.create(null),y=0,h=!1,p=null,v=null,d=1,_=2,w=4,b=8,g=0;g<u;++g){var k=(o=e[g].split(":")).shift(),E=o.shift(),A=function(e){switch(e){case"s":case"str":return d;case"i":case"int":return _;case"u":case"uint":return w;case"f":case"float":return b;default:throw new Error("Unknown type: "+e)}}(E.replace(/[\d\[\]]/g,"")),m=function(e,r){switch(e){case d:return[Uint16Array.BYTES_PER_ELEMENT,t.alloc(r||256),new Uint16Array(1)];case _:switch(r){case 8:return[Int8Array.BYTES_PER_ELEMENT,new Int8Array(1)];case 16:return[Int16Array.BYTES_PER_ELEMENT,new Int16Array(1)];case 32:return[Int32Array.BYTES_PER_ELEMENT,new Int32Array(1)];default:throw new Error("Unknown size: "+r)}case w:switch(r){case 8:return[Uint8Array.BYTES_PER_ELEMENT,new Uint8Array(1)];case 16:return[Uint16Array.BYTES_PER_ELEMENT,new Uint16Array(1)];case 32:return[Uint32Array.BYTES_PER_ELEMENT,new Uint32Array(1)];default:throw new Error("Unknown size: "+r)}case b:switch(r){case 32:return[Float32Array.BYTES_PER_ELEMENT,new Float32Array(1)];case 64:return[Float64Array.BYTES_PER_ELEMENT,new Float64Array(1)];default:throw new Error("Unknown size: "+r)}default:throw new Error("Unknown type: "+e)}}(A,parseInt(E.replace(/\D/g,""),10)||0),S=_slicedToArray(m,3),T=S[0],U=S[1],C=S[2],B=d&A?null:new Uint8Array(U.buffer),M=C?new Uint8Array(C.buffer):null;c[g]=[k,A,T,U,B,C,M],y+=T,!h&&d&A&&(h=!0)}return y+=i,h||(p=new Uint8Array(y)),{pack:r,unpack:a}}function r(e){return e[0]}var t="undefined"!=typeof Buffer?Buffer:function(){function e(e,r){r=r||1/0;for(var t=e.length,n=void 0,i=null,a=new Array,o=0;o<t;++o){if((n=e.charCodeAt(o))>55295&&n<57344){if(!i){if(n>56319){(r-=3)>-1&&a.push(239,191,189);continue}if(o+1===t){(r-=3)>-1&&a.push(239,191,189);continue}i=n;continue}if(n<56320){(r-=3)>-1&&a.push(239,191,189),i=n;continue}n=65536+(i-55296<<10|n-56320)}else i&&(r-=3)>-1&&a.push(239,191,189);if(i=null,n<128){if((r-=1)<0)break;a.push(n)}else if(n<2048){if((r-=2)<0)break;a.push(n>>6|192,63&n|128)}else if(n<65536){if((r-=3)<0)break;a.push(n>>12|224,n>>6&63|128,63&n|128)}else{if(!(n<1114112))throw new Error("Invalid code point");if((r-=4)<0)break;a.push(n>>18|240,n>>12&63|128,n>>6&63|128,63&n|128)}}return a}function r(e,r,t){t=Math.min(e.length,t);for(var n=new Array,i=r;i<t;){var a=e[i],o=null,c=a>239?4:a>223?3:a>191?2:1;if(i+c<=t){var s=void 0,f=void 0,l=void 0,y=void 0;switch(c){case 1:a<128&&(o=a);break;case 2:128==(192&(s=e[i+1]))&&(y=(31&a)<<6|63&s)>127&&(o=y);break;case 3:s=e[i+1],f=e[i+2],128==(192&s)&&128==(192&f)&&(y=(15&a)<<12|(63&s)<<6|63&f)>2047&&(y<55296||y>57343)&&(o=y);break;case 4:s=e[i+1],f=e[i+2],l=e[i+3],128==(192&s)&&128==(192&f)&&128==(192&l)&&(y=(15&a)<<18|(63&s)<<12|(63&f)<<6|63&l)>65535&&y<1114112&&(o=y)}}null===o?(o=65533,c=1):o>65535&&(o-=65536,n.push(o>>>10&1023|55296),o=56320|1023&o),n.push(o),i+=c}return u(n)}function t(e){if(e>s)throw new RangeError("Invalid typed array length");var r=new Uint8Array(e);return r.write=f.prototype.write,r.toString=f.prototype.toString,r}function n(r){return e(r).length}function i(e){return t(e)}function a(r,t,n){t=t||0,n=n||this.length;var i=this.length-t;return(!n||n>i)&&(n=i),o(e(r,this.length-t),this,t,n)}function o(e,r,t,n){var i=void 0;for(i=0;i<n&&!(i+t>=r.length||i>=e.length);++i)r[i+t]=e[i];return i}function u(e){var r=e.length;if(r<=c)return String.fromCharCode.apply(String,e);for(var t="",n=0;n<r;)t+=String.fromCharCode.apply(String,e.slice(n,n+=c));return t}var c=4096,s=2147483647,f=function(){};return f.alloc=i,f.byteLength=n,f.prototype=Object.create(null),f.prototype.write=a,f.prototype.toString=function(e,t,n){return t=t||0,n=n||this.length,0===n?"":r(this,t,n)},f}();Uint8Array.prototype.slice||Object.defineProperty(Uint8Array.prototype,"slice",{value:Array.prototype.slice});var n=function(){var e=new Uint32Array([305419896]);return 18===new Uint8Array(e.buffer,e.byteOffset,e.byteLength)[0]}(),i=1;return{isBigEndian:n,createPacket:e,getId:r}}();e.exports=t;var n=function(){return function(e){if(null===e)return"";switch(void 0===e?"undefined":_typeof(e)){case"string":return e;case"undefined":return"";case"number":return isNaN(e)?"":e+"";case"symbol":return e.toString();default:return JSON.stringify(e)}}}();return e.exports=n,function(e,i){function a(e,r){function n(e){o+=e}var i=r.data;if(e._emit("message",i,r),"string"!=typeof i){if(!e._emit("arraybuffer",i,r))for(var a=(i=new Uint8Array(i)).byteLength,o=0,u=i;o<a;){var c=s._unpackMapById[t.getId(u)];if(!c)break;var f=_slicedToArray(c,2),l=f[0],y=f[1].unpack(u,o,a,n);if(!y)break;a>o&&(u=i.slice(o)),e._emit("packet",l,y),e._emit(l,y)}}else e._emit("text",i,r)}function o(e,r){s.reconnecting&&(s.reconnecting=!1,s._emit("restored")),s._emit("open")}function u(e,r){var t=r.code,n=r.reason;s._emit("close",t,n,r),r.wasClean?s._emit("disconnected",t,n,r):(s._emit("terminated",t,r),setTimeout(function(){s.reconnecting=!0,s._reconnect(),s._emit("restoring")},2e3))}function c(e,r){s._emit("error",r)}var s=new(function(r){function i(){_classCallCheck(this,i);var r=_possibleConstructorReturn(this,(i.__proto__||Object.getPrototypeOf(i)).call(this));return e&&r.connect(e),r._packMapByName=new Map,r._unpackMapById=new Array,r.reconnecting=!1,r}return _inherits(i,r),_createClass(i,[{key:"isSupported",value:function(){return"undefined"!=typeof WebSocket}},{key:"emit",value:function(e,r){return(r=this._pack(e,r))&&this.send(r),!!r}},{key:"text",value:function(e){this.send(n(e))}},{key:"send",value:function(e){try{this._ws.send(e)}catch(e){this._emit("error",e)}}},{key:"connect",value:function(e){this._ws&&this._ws.close();var r=this._ws=new WebSocket(e);this.url=e,r.binaryType="arraybuffer",r.onmessage=a.bind(this,this),r.onopen=o.bind(this,this),r.onclose=u.bind(this,this),r.onerror=c.bind(this,this)}},{key:"disconnect",value:function(e,r){this._ws.close(e,r),this._ws=null}},{key:"packets",value:function(e,r,n){function i(e,r){e&&Object.keys(e).forEach(function(n){a(n),r(n,t.createPacket(e[n]))})}function a(e){if(["restoring","restored","open","close","disconnected","terminated","packet","message","arraybuffer","error"].some(function(r){return r===e}))throw new Error("Used a reserved name: "+e)}var o=this;return i(r,function(e,r){o._unpackMapById.push([e,r])}),i(e,function(e,r){o._packMapByName.set(e,[o._packMapByName.size,r])}),n?this.packets(n,n):this}},{key:"_reconnect",value:function(){return this.connect(this.url)}},{key:"_pack",value:function(e,r){var t=this._packMapByName.get(e);if(!t)return null;var n=_slicedToArray(t,2),i=n[0];return n[1].pack(i,r)}}]),i}(r));return s}}({});