"use strict";var _get=function e(t,r,n){null===t&&(t=Function.prototype);var i=Object.getOwnPropertyDescriptor(t,r);if(void 0===i){var o=Object.getPrototypeOf(t);return null===o?void 0:e(o,r,n)}if("value"in i)return i.value;var a=i.get;return void 0!==a?a.call(n):void 0},_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},_slicedToArray=function(){return function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function(e,t){var r=[],n=!0,i=!1,o=void 0;try{for(var a,s=e[Symbol.iterator]();!(n=(a=s.next()).done)&&(r.push(a.value),!t||r.length!==t);n=!0);}catch(e){i=!0,o=e}finally{try{!n&&s.return&&s.return()}finally{if(i)throw o}}return r}(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),_createClass=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}();function _toConsumableArray(e){if(Array.isArray(e)){for(var t=0,r=Array(e.length);t<e.length;t++)r[t]=e[t];return r}return Array.from(e)}function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var io=function(e){var t=function(){function e(){_classCallCheck(this,e),this._events=Object.create(null)}return _createClass(e,[{key:"on",value:function(e,t){var r=this._events[e];return this._events[e]="function"==typeof r?[r,t]:r?this._arrayCloneWith(r,r.length,t):t,this}},{key:"once",value:function(e,t){return this.on(e,function r(){r.fired||(this.off(e,r),r.fired=!0,t.apply(this,arguments))})}},{key:"off",value:function(e,t){var r=arguments.length;if(!r)return this._events=Object.create(null),this;var n=this._events[e];if(1===r)return delete this._events[e],this;if("function"==typeof n)return n===t&&delete this._events[e],this;var i=n&&n.length;return i?(1===i?n[0]===t&&delete this._events[e]:2===i?n[0]===t?this._events[e]=n[1]:n[1]===t&&(this._events[e]=n[0]):n.indexOf(t)>=0&&(this._events[e]=this._arrayCloneWithout(n,i,t)),this):this}},{key:"emit",value:function(e){for(var t=arguments.length,r=Array(t>1?t-1:0),n=1;n<t;n++)r[n-1]=arguments[n];var i=this._events[e];if(!i){if("error"===e){var o=arguments[1];if(o instanceof Error)throw o;var a=new Error('Unhandled "error" event. ('+o+")");throw a.context=o,a}return!1}if("function"==typeof i)i.apply(this,r);else for(var s=0,u=i.length;s<u;++s)i[s].apply(this,r);return!0}},{key:"listenerCount",value:function(e){var t=this._events;if(t){var r=t[e];if("function"==typeof r)return 1;if(r)return r.length}return 0}},{key:"_arrayCloneWithout",value:function(e,t,r){for(var n=new Array(t-1),i=void 0,o=0,a=!1;t--;)i=e[t],a||r!==i?(n[o]=i,++o):a=!0;return n}},{key:"_arrayCloneWith",value:function(e,t,r){var n=new Array(t+1);for(n[t]=r;t--;)n[t]=e[t];return n}}]),e}();e.exports=t,Uint8Array.prototype.slice||Object.defineProperty(Uint8Array.prototype,"slice",{value:function(e,t){if(void 0===e&&(e=0),void 0===t&&(t=this.byteLength),e=Math.floor(e),t=Math.floor(t),e<0&&(e+=this.byteLength),t<0&&(t+=this.byteLength),e=Math.min(Math.max(0,e),this.byteLength),(t=Math.min(Math.max(0,t),this.byteLength))-e<=0)return new ArrayBuffer(0);for(var r=t-e,n=new ArrayBuffer(r),i=new Uint8Array(n),o=new Uint8Array(this,e,r);r--;)i[r]=o[r];return i}});var r=function(){var e,t="undefined"!=typeof Buffer?Buffer:function(){var e=4096,t=2147483647;return function(){var r=function(){};return r.allocUnsafe=n,r.allocUnsafeSlow=n,r;function n(e){if(e>t)throw new RangeError("Invalid typed array length");var r=new Uint8Array(e);return r.write=o,r.toString=a,r}function o(e,t,r){t=t||0,r=r||this.length;var n=this.length-t;return(!r||r>n)&&(r=n),i(function(e,t){t=t||1/0;for(var r=e.length,n=void 0,i=null,o=new Array,a=0;a<r;++a){if((n=e.charCodeAt(a))>55295&&n<57344){if(!i){if(n>56319){(t-=3)>-1&&o.push(239,191,189);continue}if(a+1===r){(t-=3)>-1&&o.push(239,191,189);continue}i=n;continue}if(n<56320){(t-=3)>-1&&o.push(239,191,189),i=n;continue}n=65536+(i-55296<<10|n-56320)}else i&&(t-=3)>-1&&o.push(239,191,189);if(i=null,n<128){if((t-=1)<0)break;o.push(n)}else if(n<2048){if((t-=2)<0)break;o.push(n>>6|192,63&n|128)}else if(n<65536){if((t-=3)<0)break;o.push(n>>12|224,n>>6&63|128,63&n|128)}else{if(!(n<1114112))throw new Error("Invalid code point");if((t-=4)<0)break;o.push(n>>18|240,n>>12&63|128,n>>6&63|128,63&n|128)}}return o}(e,this.length-t),this,t,r)}function a(t,r,n){return r=r||0,0===(n=n||this.length)?"":function(t,r,n){n=Math.min(t.length,n);var i=new Array,o=r;for(;o<n;){var a=t[o],s=null,u=a>239?4:a>223?3:a>191?2:1;if(o+u<=n){var c=void 0,f=void 0,l=void 0,y=void 0;switch(u){case 1:a<128&&(s=a);break;case 2:128==(192&(c=t[o+1]))&&(y=(31&a)<<6|63&c)>127&&(s=y);break;case 3:c=t[o+1],f=t[o+2],128==(192&c)&&128==(192&f)&&(y=(15&a)<<12|(63&c)<<6|63&f)>2047&&(y<55296||y>57343)&&(s=y);break;case 4:c=t[o+1],f=t[o+2],l=t[o+3],128==(192&c)&&128==(192&f)&&128==(192&l)&&(y=(15&a)<<18|(63&c)<<12|(63&f)<<6|63&l)>65535&&y<1114112&&(s=y)}}null===s?(s=65533,u=1):s>65535&&(s-=65536,i.push(s>>>10&1023|55296),s=56320|1023&s),i.push(s),o+=u}return function(t){var r=t.length;if(r<=e)return String.fromCharCode.apply(String,t);var n="",i=0;for(;i<r;)n+=String.fromCharCode.apply(String,t.slice(i,i+=e));return n}(i)}(this,r,n)}}()}(),r=(e=new Uint32Array([305419896]),18===new Uint8Array(e.buffer,e.byteOffset,e.byteLength)[0]);return n.isBE=r,n.isLE=!r,n;function n(e){var n=arguments.length>1&&void 0!==arguments[1]&&arguments[1],o=arguments.length>2&&void 0!==arguments[2]&&arguments[2],a=1,s=2,u=4,c=8,f=16,l=32;if(null===e&&(e=[]),!e||!Array.isArray(e)&&"string"!=typeof e)throw new Error("Invalid schema");var y=!!Array.isArray(e)&&e.some(function(e){return e.split(":").length>=2}),h=!Array.isArray(e)||e.some(function(e){return e.split(":").length<2});if(y&&h)throw new Error("A schema has mixed names/types");h&&(o=!0);for(var v="string"==typeof e,p=v?1:e.length,_=new Array(p),d=(new Uint8Array(2),null),w=0,E=0,g=0,m=new Array,b=Object.create(null),A=0;A<p;++A){var k=v?[e,""]:e[A].split(":").reverse(),S=_slicedToArray(k,2),T=S[0],C=S[1],L=x(T.replace(/[\d\[\]]/g,"")),O=R(L,parseInt(T.replace(/\D/g,""),10)||0),N=_slicedToArray(O,3),U=N[0],P=N[1],M=N[2],B=L&s||L&a?null:new Uint8Array(P.buffer),I=M?new Uint8Array(M.buffer):null;_[A]=[C,L,U,P,B,M,I],E+=U,g+=P.byteLength}return j(0),{get minSize(){return E},get maxSize(){return g},get offset(){return w},set offset(e){j(e)},pack:function(e,t){var n=Array.isArray(e),o=!!t,u=p,c=w,f=e,y=void 0,h=void 0,E=void 0,m=void 0,b=void 0,A=void 0,k=void 0;t=t||d;for(;u--;){var S=_[u],T=_slicedToArray(S,7);if(y=T[0],h=T[1],E=T[2],m=T[3],b=T[4],A=T[5],k=T[6],!v&&e&&(f=e[n?u:y]),h&s||h&a)h&l&&(f=JSON.stringify(f)),f?(E+=A[0]=h&a?i(f,t,c+E,m.byteLength-E):t.write(f,c+E,m.byteLength-E),r?(t[c]=k[1],t[c+1]=k[0]):(t[c]=k[0],t[c+1]=k[1]),c+=E):(t[c]=0,t[c+1]=0,c+=2);else{null==f||"bigint"!=typeof f&&(isNaN(f)||!isFinite(f))?m[0]=0:(m[0]=f,r&&m.byteLength>1&&b.reverse());for(var C=0;C<E;)t[c]=b[C],++c,++C}}return!o&&c<g?t.slice(0,c):t},unpack:function(e,i,u,c,f){var y=arguments.length>5&&void 0!==arguments[5]?arguments[5]:!n,h=arguments.length>6&&void 0!==arguments[6]?arguments[6]:o;if(!p)return c&&c(w),null;if(!e||"object"!==(void 0===e?"undefined":_typeof(e))||e.byteLength<E)return;v||(f=f||(y?h?new Array:Object.create(null):h?m:b));var d=p,g=i+w,A=g;for(;d--;){for(var k=void 0,S=_slicedToArray(_[d],7),T=S[0],C=S[1],L=S[2],O=S[3],N=S[4],U=S[5],P=S[6],M=0;M<L;++M){if(g>=u)return;U?P[M]=e[g]:N[M]=e[g],++g}if(C&s||C&a){r&&P.reverse();var B=U[0];if(B){if(B>=u||B>O.byteLength)return;if(C&a){for(var I=t.allocUnsafeSlow(B),j=0;j<B;++j,++g)I[j]=e[g];k=I}else k=e instanceof t?e.toString("utf8",g,g+B):t.from?t.from(e).toString("utf8",g,g+B):O.toString.call(e,"utf8",g,g+B),g+=B;if(C&l)try{k=JSON.parse(k)}catch(e){k=null}}else k=C&a||C&l?null:""}else r&&O.byteLength>1&&N.reverse(),k=O[0];v?f=k:(h&&(T=d),f[T]=k)}c&&c(w+g-A);return f}};function j(e){e=parseInt(e,10)||0,E=E-w+e,g=g-w+e,w=e,d=t.allocUnsafeSlow(g)}function R(e,r){if(e&a)return[Uint16Array.BYTES_PER_ELEMENT,t.allocUnsafeSlow((r||1024)+Uint16Array.BYTES_PER_ELEMENT),new Uint16Array(1)];if(e&l)return[Uint16Array.BYTES_PER_ELEMENT,t.allocUnsafeSlow((r||8192)+Uint16Array.BYTES_PER_ELEMENT),new Uint16Array(1)];if(e&s)return[Uint16Array.BYTES_PER_ELEMENT,t.allocUnsafeSlow((r||256)+Uint16Array.BYTES_PER_ELEMENT),new Uint16Array(1)];switch(e){case u:switch(r){case 8:return[Int8Array.BYTES_PER_ELEMENT,new Int8Array(1)];case 16:return[Int16Array.BYTES_PER_ELEMENT,new Int16Array(1)];case 32:return[Int32Array.BYTES_PER_ELEMENT,new Int32Array(1)];case 64:return[BigInt64Array.BYTES_PER_ELEMENT,new BigInt64Array(1)];default:throw new Error("Unknown size: "+r)}case c:switch(r){case 8:return[Uint8Array.BYTES_PER_ELEMENT,new Uint8Array(1)];case 16:return[Uint16Array.BYTES_PER_ELEMENT,new Uint16Array(1)];case 32:return[Uint32Array.BYTES_PER_ELEMENT,new Uint32Array(1)];case 64:return[BigUint64Array.BYTES_PER_ELEMENT,new BigUint64Array(1)];default:throw new Error("Unknown size: "+r)}case f:switch(r){case 32:return[Float32Array.BYTES_PER_ELEMENT,new Float32Array(1)];case 64:return[Float64Array.BYTES_PER_ELEMENT,new Float64Array(1)];default:throw new Error("Unknown size: "+r)}default:throw new Error("Unknown type: "+e)}}function x(e){switch(e){case"b":case"bin":return a;case"j":case"json":return s|l;case"s":case"str":return s;case"i":case"int":return u;case"u":case"uint":return c;case"f":case"float":return f;default:throw new Error("Unknown type: "+e)}}}function i(e,t,r,n){if(!n)return 0;var i=t.length,o=e.length,a=void 0,s=void 0;for(a=0;a<n&&!((s=a+r)>=i||a>=o);++a)t[s]=e[a];return a}}();function n(e){if(null===e)return"";switch(void 0===e?"undefined":_typeof(e)){case"string":return e;case"undefined":return"";case"boolean":return e?"true":"false";case"number":return isNaN(e)?"":e.toString();case"bigint":case"symbol":return e.toString();default:return JSON.stringify(e)}}e.exports=r,e.exports=n;var i=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:require("./../src/toString"),r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:require("xee"),n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:require("2pack"),i=n("uint16"),o=function(o){function a(t,r){_classCallCheck(this,a);var n=_possibleConstructorReturn(this,(a.__proto__||Object.getPrototypeOf(a)).call(this));if(n._emit=_get(a.prototype.__proto__||Object.getPrototypeOf(a.prototype),"emit",n),n._reconnectionDelay=1e3*Math.max(1,r.reconnectionDelay||0),n._reconnectionAttempts=r.reconnectionAttempts||1/0,n._reconnectionAttemptsCount=0,n._packMapByName=new Map,n._unpackMapById=new Array,n.reconnecting=!1,n.CONNECTING=e.CONNECTING,n.OPEN=e.OPEN,n.CLOSING=e.CLOSING,n.CLOSED=e.CLOSED,t){var i=t.trim().split(/(^wss?:\/\/)/i),o=i.pop().replace(/^[:\/\/]*/,""),s=(i.pop()||"").trim(),u=!(!s||!s.match(/^wss:\/\//i)),c=r.secure;void 0===c&&(c=s?u:!!document.location.protocol.match(/^https/i)),n._connect((c?"wss":"ws")+"://"+o)}return n}return _inherits(a,r),_createClass(a,[{key:"emit",value:function(e,t){return(t=this._pack(e,t))?(this.send(t),t.byteLength):0}},{key:"text",value:function(e){this.send(t(e))}},{key:"json",value:function(e){this.send(JSON.stringify(e))}},{key:"send",value:function(e){var t=this.readyState;try{if(t===this.CLOSING||t===this.CLOSED)throw new Error("WebSocket is already in CLOSING or CLOSED state.");this._ws.send(e)}catch(e){this._emit("error",e)}}},{key:"disconnect",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1e3,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",r=this.readyState;return r!==this.CLOSING&&r!==this.CLOSED&&this._ws.close(e,t),this}},{key:"packets",value:function(e,t,r){var o=this;return a(t,function(e,t){o._unpackMapById.push([e,t])}),a(e,function(e,t){o._packMapByName.set(e,[o._packMapByName.size,t])}),r?this.packets(r,r):this;function a(e,t){e&&Object.keys(e).forEach(function(r){var o=r.split(/\(([\[\{]?)(\@?)([\}\]]?)\)$/),a=o.shift().trim(),s="["===o.shift(),u="@"===o.shift(),c=e[r],f=n(c,u,s);f.offset=i.maxSize,function(e){if(["restoring","restored","open","close","disconnected","terminated","packet","message","arraybuffer","error","ping","pong"].some(function(t){return t===e}))throw new Error("Used a reserved name: "+e)}(a),t(a,f)})}}},{key:"sendPacketTransform",value:function(e){return this._sendPacketTransform=e,this}},{key:"recvPacketTransform",value:function(e){return this._recvPacketTransform=e,this}},{key:"_connect",value:function(t){try{this._ws=new e(t)}catch(e){return void this._emit("error",e)}var r=this._ws;r.onmessage=function(e,t){var r=t.data;{if(e._emit("message",r,t),"string"==typeof r){if(e._emit("text",r,t),e.listenerCount("json")){try{r=JSON.parse(r)}catch(e){r=void 0}void 0!==r&&e._emit("json",r,t)}return}if(e._emit("arraybuffer",r,t))return}r=new Uint8Array(r);var n=e._recvPacketTransform;if(n&&!(r=n(r)))return;var o=r.byteLength,a=0,s=function(){var t=i.unpack(r,a,o),n=e._unpackMapById[t];if(!n)return"break";var s=_slicedToArray(n,2),u=s[0],f=s[1],l=f.unpack(r,a,o,c);if(void 0===l)return"break";e.listenerCount("packet")?e._emit("packet",u,l,function(){return e._emit(u,l)}):e._emit(u,l)};for(;a<o;){var u=s();if("break"===u)break}function c(e){a+=e}}.bind(r,this),r.onopen=function(e,t){var r=e._reconnectionAttemptsCount;e._reconnectionAttemptsCount=0,e.reconnecting&&(e.reconnecting=!1,e._emit("restored",r));e._emit("open")}.bind(r,this),r.onclose=function(e,t){var r=t.code,n=t.reason;if(e._emit("close",r,n,t),t.wasClean)e._emit("disconnected",r,n,t);else{var i=e._reconnectionAttemptsCount;e._emit("terminated",r,t),i<e._reconnectionAttempts?(e._reconnectionAttemptsCount++,setTimeout(function(){e.reconnecting=!0,e._reconnect(),e._emit("restoring",i)},e._reconnectionDelay)):(e.reconnecting=!1,e._emit("unrestored",i))}}.bind(r,this),r.onerror=function(e,t){var r=new Error(t.message||t.data||"");r.event=t,e._emit("error",r)}.bind(r,this),r.binaryType="arraybuffer"}},{key:"_reconnect",value:function(){this._connect(this.url)}},{key:"_pack",value:function(e,t){var r=this._packMapByName.get(e);if(r){var n=_slicedToArray(r,2),o=n[0],a=n[1],s=this._sendPacketTransform;return t=i.pack(o,a.pack(t)),s?s(e,t):t}return null}},{key:"bufferedAmount",get:function(){return this._ws&&this._ws.bufferedAmount||0}},{key:"readyState",get:function(){return this._ws?this._ws.readyState:this.CLOSED}},{key:"url",get:function(){return this._ws&&this._ws.url||""}}]),a}();return e?function e(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};var n=new o(t,r);Array.isArray(e.__staticPackets)&&n.packets.apply(n,_toConsumableArray(e.__staticPackets));return n}:null};return e.exports=i,i(window.WebSocket||window.MozWebSocket,n,t,r)}({});