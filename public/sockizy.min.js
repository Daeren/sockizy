"use strict";var _get=function e(t,r,n){null===t&&(t=Function.prototype);var i=Object.getOwnPropertyDescriptor(t,r);if(void 0===i){var o=Object.getPrototypeOf(t);return null===o?void 0:e(o,r,n)}if("value"in i)return i.value;var a=i.get;return void 0!==a?a.call(n):void 0},_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},_slicedToArray=function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function(e,t){var r=[],n=!0,i=!1,o=void 0;try{for(var a,s=e[Symbol.iterator]();!(n=(a=s.next()).done)&&(r.push(a.value),!t||r.length!==t);n=!0);}catch(e){i=!0,o=e}finally{try{!n&&s.return&&s.return()}finally{if(i)throw o}}return r}(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")},_createClass=function(){function n(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(e,t,r){return t&&n(e.prototype,t),r&&n(e,r),e}}();function _toConsumableArray(e){if(Array.isArray(e)){for(var t=0,r=Array(e.length);t<e.length;t++)r[t]=e[t];return r}return Array.from(e)}function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var io=function(e){var t=(_createClass(r,[{key:"on",value:function(e,t){var r=this._events[e];return this._events[e]="function"==typeof r?[r,t]:r?this._arrayCloneWith(r,r.length,t):t,this}},{key:"once",value:function(t,r){return this.on(t,function e(){e.fired||(this.off(t,e),e.fired=!0,r.apply(this,arguments))})}},{key:"off",value:function(e,t){var r=arguments.length;if(!r)return this._events=Object.create(null),this;var n=this._events[e];if(1===r)return delete this._events[e],this;if("function"==typeof n)return n===t&&delete this._events[e],this;var i=n&&n.length;return i&&(1===i?n[0]===t&&delete this._events[e]:2===i?n[0]===t?this._events[e]=n[1]:n[1]===t&&(this._events[e]=n[0]):0<=n.indexOf(t)&&(this._events[e]=this._arrayCloneWithout(n,i,t))),this}},{key:"emit",value:function(e,t){for(var r=arguments.length,n=Array(1<r?r-1:0),i=1;i<r;i++)n[i-1]=arguments[i];var o=this._events[e];if(!o){if("error"!==e)return!1;var a=t;if(a instanceof Error)throw a;var s=new Error('Unhandled "error" event. ('+a+")");throw s.context=a,s}if("function"==typeof o)o.apply(this,n);else for(var u=0,c=o.length;u<c;++u)o[u].apply(this,n);return!0}},{key:"listenerCount",value:function(e){var t=this._events;if(t){var r=t[e];if("function"==typeof r)return 1;if(r)return r.length}return 0}},{key:"_arrayCloneWithout",value:function(e,t,r){for(var n=new Array(t-1),i=void 0,o=0,a=!1;t--;)i=e[t],a||r!==i?(n[o]=i,++o):a=!0;return n}},{key:"_arrayCloneWith",value:function(e,t,r){var n=new Array(t+1);for(n[t]=r;t--;)n[t]=e[t];return n}}]),r);function r(){_classCallCheck(this,r),this._events=Object.create(null)}e.exports=t,Uint8Array.prototype.slice||Object.defineProperty(Uint8Array.prototype,"slice",{value:function(e,t){if(void 0===e&&(e=0),void 0===t&&(t=this.byteLength),e=Math.floor(e),t=Math.floor(t),e<0&&(e+=this.byteLength),t<0&&(t+=this.byteLength),e=Math.min(Math.max(0,e),this.byteLength),(t=Math.min(Math.max(0,t),this.byteLength))-e<=0)return new ArrayBuffer(0);for(var r=t-e,n=new ArrayBuffer(r),i=new Uint8Array(n),o=new Uint8Array(this,e,r);r--;)i[r]=o[r];return i}});var y,R,n,x,i=(R="undefined"!=typeof Buffer?Buffer:(y=4096,o.allocUnsafe=a,o.allocUnsafeSlow=a,o),n=new Uint32Array([305419896]),x=18===new Uint8Array(n.buffer,n.byteOffset,n.byteLength)[0],c.isBE=x,c.isLE=!x,c);function o(){}function a(e){if(2147483647<e)throw new RangeError("Invalid typed array length");var t=new Uint8Array(e);return t.write=s,t.toString=u,t}function s(e,t,r){t=t||0,r=r||this.length;var n=this.length-t;return(!r||n<r)&&(r=n),Y(function(e,t){t=t||1/0;for(var r=e.length,n=void 0,i=null,o=new Array,a=0;a<r;++a){if(55295<(n=e.charCodeAt(a))&&n<57344){if(!i){if(56319<n){-1<(t-=3)&&o.push(239,191,189);continue}if(a+1===r){-1<(t-=3)&&o.push(239,191,189);continue}i=n;continue}if(n<56320){-1<(t-=3)&&o.push(239,191,189),i=n;continue}n=65536+(i-55296<<10|n-56320)}else i&&-1<(t-=3)&&o.push(239,191,189);if(i=null,n<128){if((t-=1)<0)break;o.push(n)}else if(n<2048){if((t-=2)<0)break;o.push(n>>6|192,63&n|128)}else if(n<65536){if((t-=3)<0)break;o.push(n>>12|224,n>>6&63|128,63&n|128)}else{if(!(n<1114112))throw new Error("Invalid code point");if((t-=4)<0)break;o.push(n>>18|240,n>>12&63|128,n>>6&63|128,63&n|128)}}return o}(e,this.length-t),this,t,r)}function u(e,t,r){return t=t||0,0===(r=r||this.length)?"":function(e,t,r){r=Math.min(e.length,r);var n=new Array,i=t;for(;i<r;){var o=e[i],a=null,s=239<o?4:223<o?3:191<o?2:1;if(i+s<=r){var u=void 0,c=void 0,f=void 0,l=void 0;switch(s){case 1:o<128&&(a=o);break;case 2:128==(192&(u=e[i+1]))&&127<(l=(31&o)<<6|63&u)&&(a=l);break;case 3:u=e[i+1],c=e[i+2],128==(192&u)&&128==(192&c)&&2047<(l=(15&o)<<12|(63&u)<<6|63&c)&&(l<55296||57343<l)&&(a=l);break;case 4:u=e[i+1],c=e[i+2],f=e[i+3],128==(192&u)&&128==(192&c)&&128==(192&f)&&65535<(l=(15&o)<<18|(63&u)<<12|(63&c)<<6|63&f)&&l<1114112&&(a=l)}}null===a?(a=65533,s=1):65535<a&&(a-=65536,n.push(a>>>10&1023|55296),a=56320|1023&a),n.push(a),i+=s}return function(e){var t=e.length;if(t<=y)return String.fromCharCode.apply(String,e);var r="",n=0;for(;n<t;)r+=String.fromCharCode.apply(String,e.slice(n,n+=y));return r}(n)}(this,t,r)}function c(e){var A=1<arguments.length&&void 0!==arguments[1]&&arguments[1],k=2<arguments.length&&void 0!==arguments[2]&&arguments[2],S=1,T=2,r=4,n=8,i=16,C=32;if(null===e&&(e=[]),!e||!Array.isArray(e)&&"string"!=typeof e)throw new Error("Invalid schema");var t=!!Array.isArray(e)&&e.some(function(e){return 2<=e.split(":").length}),o=!Array.isArray(e)||e.some(function(e){return e.split(":").length<2});if(t&&o)throw new Error("A schema has mixed names/types");o&&(k=!0);for(var E="undefined"!=typeof BigInt64Array?BigInt64Array.BYTES_PER_ELEMENT:0,L="string"==typeof e,N=L?1:e.length,O=new Array(N),w=(new Uint8Array(2),null),U=0,B=0,g=0,P=new Array,M=Object.create(null),a=0;a<N;++a){var s=L?[e,""]:e[a].split(":").reverse(),u=_slicedToArray(s,2),c=u[0],f=u[1],l=j(c.replace(/[\d\[\]]/g,"")),y=I(l,parseInt(c.replace(/\D/g,""),10)||0),h=_slicedToArray(y,3),v=h[0],p=h[1],_=h[2],d=l&T||l&S?null:new Uint8Array(p.buffer),m=_?new Uint8Array(_.buffer):null;O[a]=[f,l,v,p,d,_,m],B+=v,g+=p.byteLength}return b(0),{get minSize(){return B},get maxSize(){return g},get offset(){return U},set offset(e){b(e)},pack:function(e,t){var r=Array.isArray(e),n=!!t,i=N,o=U,a=e,s=void 0,u=void 0,c=void 0,f=void 0,l=void 0,y=void 0,h=void 0,v=void 0;t=t||w;for(;i--;){s=O[i];var p=_slicedToArray(s,7);if(u=p[0],c=p[1],f=p[2],l=p[3],y=p[4],h=p[5],v=p[6],!L&&e&&(a=e[r?i:u]),c&T||c&S)c&C&&(a=JSON.stringify(a)),a?(f+=h[0]=c&S?Y(a,t,o+f,l.byteLength-f):t.write(a,o+f,l.byteLength-f),x?(t[o]=v[1],t[o+1]=v[0]):(t[o]=v[0],t[o+1]=v[1]),o+=f):(t[o]=0,t[o+1]=0,o+=2);else{var _=0;f===E&&(_=BigInt("0")),null==a||"bigint"!=typeof a&&(isNaN(a)||!isFinite(a))?l[0]=_:(l[0]=a,x&&1<l.byteLength&&y.reverse());for(var d=0;d<f;)t[o]=y[d],++o,++d}}return!n&&o<g?t.slice(0,o):t},unpack:function(e,t,r,n,i){var o=5<arguments.length&&void 0!==arguments[5]?arguments[5]:!A,a=6<arguments.length&&void 0!==arguments[6]?arguments[6]:k;if(!N)return n&&n(U),null;if(!e||"object"!==(void 0===e?"undefined":_typeof(e))||e.byteLength<B)return;L||(i=i||(o?a?new Array:Object.create(null):a?P:M));var s=N,u=t+U,c=u;for(;s--;){for(var f=void 0,l=_slicedToArray(O[s],7),y=l[0],h=l[1],v=l[2],p=l[3],_=l[4],d=l[5],E=l[6],w=0;w<v;++w){if(r<=u)return;d?E[w]=e[u]:_[w]=e[u],++u}if(h&T||h&S){x&&E.reverse();var g=d[0];if(g){if(r<=g||g>p.byteLength)return;if(h&S){for(var m=R.allocUnsafeSlow(g),b=0;b<g;++b,++u)m[b]=e[u];f=m}else f=e instanceof R?e.toString("utf8",u,u+g):R.from?R.from(e).toString("utf8",u,u+g):p.toString.call(e,"utf8",u,u+g),u+=g;if(h&C)try{f=JSON.parse(f)}catch(e){f=null}}else f=h&S||h&C?null:""}else x&&1<p.byteLength&&_.reverse(),f=p[0];L?i=f:(a&&(y=s),i[y]=f)}n&&n(U+u-c);return i}};function b(e){e=parseInt(e,10)||0,B=B-U+e,g=g-U+e,U=e,w=R.allocUnsafeSlow(g)}function I(e,t){if(e&S)return[Uint16Array.BYTES_PER_ELEMENT,R.allocUnsafeSlow((t||1024)+Uint16Array.BYTES_PER_ELEMENT),new Uint16Array(1)];if(e&C)return[Uint16Array.BYTES_PER_ELEMENT,R.allocUnsafeSlow((t||8192)+Uint16Array.BYTES_PER_ELEMENT),new Uint16Array(1)];if(e&T)return[Uint16Array.BYTES_PER_ELEMENT,R.allocUnsafeSlow((t||256)+Uint16Array.BYTES_PER_ELEMENT),new Uint16Array(1)];switch(e){case r:switch(t){case 8:return[Int8Array.BYTES_PER_ELEMENT,new Int8Array(1)];case 16:return[Int16Array.BYTES_PER_ELEMENT,new Int16Array(1)];case 32:return[Int32Array.BYTES_PER_ELEMENT,new Int32Array(1)];case 64:return[BigInt64Array.BYTES_PER_ELEMENT,new BigInt64Array(1)];default:throw new Error("Unknown size: "+t+" | "+e)}case n:switch(t){case 8:return[Uint8Array.BYTES_PER_ELEMENT,new Uint8Array(1)];case 16:return[Uint16Array.BYTES_PER_ELEMENT,new Uint16Array(1)];case 32:return[Uint32Array.BYTES_PER_ELEMENT,new Uint32Array(1)];case 64:return[BigUint64Array.BYTES_PER_ELEMENT,new BigUint64Array(1)];default:throw new Error("Unknown size: "+t+" | "+e)}case i:switch(t){case 32:return[Float32Array.BYTES_PER_ELEMENT,new Float32Array(1)];case 64:return[Float64Array.BYTES_PER_ELEMENT,new Float64Array(1)];default:throw new Error("Unknown size: "+t+" | "+e)}default:throw new Error("Unknown type: "+e+" | "+e)}}function j(e){switch(e){case"b":case"bin":return S;case"j":case"json":return T|C;case"s":case"str":return T;case"i":case"int":return r;case"u":case"uint":return n;case"f":case"float":return i;default:throw new Error("Unknown type: "+e)}}}function Y(e,t,r,n){if(!n)return 0;var i=t.length,o=e.length,a=void 0,s=void 0;for(a=0;a<n&&!(i<=(s=a+r)||o<=a);++a)t[s]=e[a];return a}function f(e){if(null===e)return"";switch(void 0===e?"undefined":_typeof(e)){case"string":return e;case"undefined":return"";case"boolean":return e?"true":"false";case"number":return isNaN(e)?"":e.toString();case"bigint":case"symbol":return e.toString();default:return JSON.stringify(e)}}e.exports=i,e.exports=f;function l(u,e,t,r){var n=1<arguments.length&&void 0!==e?e:require("./../src/toString"),i=2<arguments.length&&void 0!==t?t:require("xee"),c=3<arguments.length&&void 0!==r?r:require("2pack"),f=c("uint16"),o=(_inherits(l,i),_createClass(l,[{key:"emit",value:function(e,t){return(t=this._pack(e,t))?(this.send(t),t.byteLength):0}},{key:"text",value:function(e){this.send(n(e))}},{key:"json",value:function(e){this.send(JSON.stringify(e))}},{key:"send",value:function(e){var t=this.readyState;try{if(t===this.CLOSING||t===this.CLOSED)throw new Error("WebSocket is already in CLOSING or CLOSED state.");this._ws.send(e)}catch(e){this._emit("error",e)}}},{key:"disconnect",value:function(e,t){var r=0<arguments.length&&void 0!==e?e:1e3,n=1<arguments.length&&void 0!==t?t:"",i=this.readyState;return i!==this.CLOSING&&i!==this.CLOSED&&this._ws.close(r,n),this}},{key:"packets",value:function(e,t,r){var n=this;return i(t,function(e,t){n._unpackMapById.push([e,t])}),i(e,function(e,t){n._packMapByName.set(e,[n._packMapByName.size,t])}),r?this.packets(r,r):this;function i(s,u){s&&Object.keys(s).forEach(function(e){var t=e.split(/\(([\[\{]?)(\@?)([\}\]]?)\)$/),r=t.shift().trim(),n="["===t.shift(),i="@"===t.shift(),o=s[e],a=c(o,i,n);a.offset=f.maxSize,function(t){if(["restoring","restored","open","close","disconnected","terminated","packet","message","arraybuffer","error","ping","pong"].some(function(e){return e===t}))throw new Error("Used a reserved name: "+t)}(r),u(r,a)})}}},{key:"sendPacketTransform",value:function(e){return this._sendPacketTransform=e,this}},{key:"recvPacketTransform",value:function(e){return this._recvPacketTransform=e,this}},{key:"_connect",value:function(e){try{this._ws=new u(e)}catch(e){return void this._emit("error",e)}var t=this._ws;t.onmessage=function(o,e){var a=e.data;if(o._emit("message",a,e),"string"!=typeof a){if(!o._emit("arraybuffer",a,e)){a=new Uint8Array(a);var t=o._recvPacketTransform;if(!t||(a=t(a)))for(var s=a.byteLength,u=0;u<s&&"break"!==r(););}}else if(o._emit("text",a,e),o.listenerCount("json")){try{a=JSON.parse(a)}catch(e){a=void 0}void 0!==a&&o._emit("json",a,e)}function r(){var e=f.unpack(a,u,s),t=o._unpackMapById[e];if(!t)return"break";var r=_slicedToArray(t,2),n=r[0],i=r[1].unpack(a,u,s,c);if(void 0===i)return"break";o.listenerCount("packet")?o._emit("packet",n,i,function(){return o._emit(n,i)}):o._emit(n,i)}function c(e){u+=e}}.bind(t,this),t.onopen=function(e,t){var r=e._reconnectionAttemptsCount;e._reconnectionAttemptsCount=0,e.reconnecting&&(e.reconnecting=!1,e._emit("restored",r)),e._emit("open")}.bind(t,this),t.onclose=function(e,t){var r=t.code,n=t.reason;if(e._emit("close",r,n,t),t.wasClean)e._emit("disconnected",r,n,t);else{var i=e._reconnectionAttemptsCount;e._emit("terminated",r,t),i<e._reconnectionAttempts?(e._reconnectionAttemptsCount++,setTimeout(function(){e.reconnecting=!0,e._reconnect(),e._emit("restoring",i)},e._reconnectionDelay)):(e.reconnecting=!1,e._emit("unrestored",i))}}.bind(t,this),t.onerror=function(e,t){var r=new Error(t.message||t.data||"");r.event=t,e._emit("error",r)}.bind(t,this),t.binaryType="arraybuffer"}},{key:"_reconnect",value:function(){this._connect(this.url)}},{key:"_pack",value:function(e,t){var r=this._packMapByName.get(e);if(r){var n=_slicedToArray(r,2),i=n[0],o=n[1],a=this._sendPacketTransform;return t=f.pack(i,o.pack(t)),a?a(e,t):t}return null}},{key:"bufferedAmount",get:function(){return this._ws&&this._ws.bufferedAmount||0}},{key:"readyState",get:function(){return this._ws?this._ws.readyState:this.CLOSED}},{key:"url",get:function(){return this._ws&&this._ws.url||""}}]),l);function l(e,t){_classCallCheck(this,l);var r=_possibleConstructorReturn(this,(l.__proto__||Object.getPrototypeOf(l)).call(this));if(r._emit=_get(l.prototype.__proto__||Object.getPrototypeOf(l.prototype),"emit",r),r._reconnectionDelay=1e3*Math.max(1,t.reconnectionDelay||0),r._reconnectionAttempts=t.reconnectionAttempts||1/0,r._reconnectionAttemptsCount=0,r._packMapByName=new Map,r._unpackMapById=new Array,r.reconnecting=!1,r.CONNECTING=u.CONNECTING,r.OPEN=u.OPEN,r.CLOSING=u.CLOSING,r.CLOSED=u.CLOSED,e){var n=e.trim().split(/(^wss?:\/\/)/i),i=n.pop().replace(/^[:\/\/]*/,""),o=(n.pop()||"").trim(),a=!(!o||!o.match(/^wss:\/\//i)),s=t.secure;void 0===s&&(s=o?a:!!document.location.protocol.match(/^https/i)),r._connect((s?"wss":"ws")+"://"+i)}return r}return u?function e(t){var r=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};var n=new o(t,r);Array.isArray(e.__staticPackets)&&n.packets.apply(n,_toConsumableArray(e.__staticPackets));return n}:null}return(e.exports=l)(window.WebSocket||window.MozWebSocket,f,t,i)}({});