"use strict";function _possibleConstructorReturn(e,r){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!r||"object"!=typeof r&&"function"!=typeof r?e:r}function _inherits(e,r){if("function"!=typeof r&&null!==r)throw new TypeError("Super expression must either be null or a function, not "+typeof r);e.prototype=Object.create(r&&r.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),r&&(Object.setPrototypeOf?Object.setPrototypeOf(e,r):e.__proto__=r)}function _classCallCheck(e,r){if(!(e instanceof r))throw new TypeError("Cannot call a class as a function")}var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},_slicedToArray=function(){function e(e,r){var t=[],n=!0,i=!1,o=void 0;try{for(var a,u=e[Symbol.iterator]();!(n=(a=u.next()).done)&&(t.push(a.value),!r||t.length!==r);n=!0);}catch(e){i=!0,o=e}finally{try{!n&&u.return&&u.return()}finally{if(i)throw o}}return t}return function(r,t){if(Array.isArray(r))return r;if(Symbol.iterator in Object(r))return e(r,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),_createClass=function(){function e(e,r){for(var t=0;t<r.length;t++){var n=r[t];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(r,t,n){return t&&e(r.prototype,t),n&&e(r,n),r}}(),io=function(e){var r=function(){function e(e,r,t){if(r)e.call(t);else for(var n=0,i=e.length;n<i;++n)e[n].call(t)}function r(e,r,t,n){if(r)e.call(t,n);else for(var i=0,o=e.length;i<o;++i)e[i].call(t,n)}function t(e,r,t,n,i){if(r)e.call(t,n,i);else for(var o=0,a=e.length;o<a;++o)e[o].call(t,n,i)}function n(e,r,t,n,i,o){if(r)e.call(t,n,i,o);else for(var a=0,u=e.length;a<u;++a)e[a].call(t,n,i,o)}function i(e,r,t,n){if(r)e.apply(t,n);else for(var i=0,o=e.length;i<o;++i)e[i].apply(t,n)}return function(){function o(){_classCallCheck(this,o),this._events={}}return _createClass(o,[{key:"on",value:function(e,r){var t=this._events[e];return this._events[e]="function"==typeof t?[t,r]:t?this._arrayCloneWith(t,t.length,r):r,this}},{key:"off",value:function(e,r){var t=arguments.length;if(!t)return this._events={},this;var n=this._events[e];if("function"==typeof n)return 1!==t&&n!==r||(this._events[e]=null),this;var i=n&&n.length;return i?(1===t?1===i?n.pop():this._events[e]=new Array:1===i?n[0]===r&&n.pop():n.indexOf(r)>=0&&(this._events[e]=this._arrayCloneWithout(n,i,r)),this):this}},{key:"_emit",value:function(o){var a=this._events[o];if(!a){if("error"===o){var u=arguments[1];if(u instanceof Error)throw u;var s=new Error('Unhandled "error" event. ('+u+")");throw s.context=u,s}return!1}var c="function"==typeof a,f=arguments.length;switch(f){case 1:e(a,c,this);break;case 2:r(a,c,this,arguments[1]);break;case 3:t(a,c,this,arguments[1],arguments[2]);break;case 4:n(a,c,this,arguments[1],arguments[2],arguments[3]);break;default:for(var l=new Array(f-1),y=1;y<f;y++)l[y-1]=arguments[y];i(a,c,this,l)}return!0}},{key:"_arrayCloneWithout",value:function(e,r,t){for(var n=new Array(--r),i=void 0;r--;)t!==(i=e[r])&&(n[r]=i);return n}},{key:"_arrayCloneWith",value:function(e,r,t){for(var n=new Array(r+1);r--;)n[r]=e[r];return n[r]=t,n}}]),o}()}();e.exports=r;var t=function(){function e(e){function r(e,r){for(var t=Array.isArray(r),o=void 0,a=void 0,f=void 0,l=void 0,y=void 0,d=void 0,_=void 0,w=void 0,b=u,E=i,g=void 0,k=void 0;b--;){a=s[b];var A=_slicedToArray(a,7);switch(f=A[0],l=A[1],A[2],y=A[3],d=A[4],_=A[5],w=A[6],o=r[t?b:f],l){case p:var m=_.byteLength,T=o?y.write(o,m):0;for(_[0]=T,n?(y[0]=w[1],y[1]=w[0]):(y[0]=w[0],y[1]=w[1]),T+=m,d&&d.length===T||(d=a[4]=new Uint8Array(T));T--;)d[T]=y[T];break;default:y[0]=o,n&&y.byteLength>1&&y.reverse()}if(g=d.length,h)for(k=0;g--;)h[E++]=d[k++];else c[b]=d,E+=g}if(h)return h[0]=e,h;var S=v&&v.length===E?v:null,U=i;for(b=u,S||(S=v=new Uint8Array(E));b--;)for(var C=c[b],B=0,M=C.length;B<M;B++)S[U++]=C[B];return S[0]=e,S}function o(e,r,o,a,c){if(c=c||f,!e||"object"!==(void 0===e?"undefined":_typeof(e))||!y&&e.byteLength!==l||e.byteLength<l)return null;if(!u)return a&&a(i),c;for(var h=void 0,v=u,d=void 0,_=void 0,w=void 0,b=void 0,E=void 0,g=void 0,k=void 0,A=r+i,m=A;v--;){h=s[v];var T=_slicedToArray(h,7);d=T[0],_=T[1],w=T[2],b=T[3],E=T[4],g=T[5],k=T[6];for(var S=0;S<w;S++){if(A>=o)return null;g?k[S]=e[A++]:E[S]=e[A++]}switch(_){case p:n&&g.reverse();var U=g[0],C=Math.min(U,o);b=t.from(e.slice(A,A+C)),A+=C,c[d]=b.toString();break;default:n&&b.byteLength>1&&b.reverse(),c[d]=b[0]}}return a&&a(i+A-m),c}Array.isArray(e)||(e=new Array);for(var a,u=e.length,s=new Array(u),c=new Array(u),f=Object.create(null),l=0,y=!1,h=null,v=null,p=1,d=2,_=4,w=8,b=0;b<u;b++){var E=(a=e[b].split(":")).shift(),g=a.shift(),k=function(e){switch(e){case"str":return p;case"int":return d;case"uint":return _;case"float":return w;default:throw new Error("Unknown type: "+e)}}(g.replace(/[\d\[\]]/g,"")),A=function(e,r){switch(e){case p:if(r&&r%Uint16Array.BYTES_PER_ELEMENT!=0)throw new RangeError("Buffer size must be a multiple of 16-bits | str:"+r);return[Uint16Array.BYTES_PER_ELEMENT,t.alloc(r||256),new Uint16Array(1)];case d:switch(r){case 8:return[Int8Array.BYTES_PER_ELEMENT,new Int8Array(1)];case 16:return[Int16Array.BYTES_PER_ELEMENT,new Int16Array(1)];case 32:return[Int32Array.BYTES_PER_ELEMENT,new Int32Array(1)];default:throw new Error("Unknown size: "+r)}case _:switch(r){case 8:return[Uint8Array.BYTES_PER_ELEMENT,new Uint8Array(1)];case 16:return[Uint16Array.BYTES_PER_ELEMENT,new Uint16Array(1)];case 32:return[Uint32Array.BYTES_PER_ELEMENT,new Uint32Array(1)];default:throw new Error("Unknown size: "+r)}case w:switch(r){case 32:return[Float32Array.BYTES_PER_ELEMENT,new Float32Array(1)];case 64:return[Float64Array.BYTES_PER_ELEMENT,new Float64Array(1)];default:throw new Error("Unknown size: "+r)}default:throw new Error("Unknown type: "+e)}}(k,parseInt(g.replace(/\D/g,""),10)||0),m=_slicedToArray(A,3),T=m[0],S=m[1],U=m[2],C=p&k?null:new Uint8Array(S.buffer),B=U?new Uint8Array(U.buffer):null;s[b]=[E,k,T,S,C,U,B],l+=T,!y&&p&k&&(y=!0)}return l+=i,y||(h=new Uint8Array(l)),{pack:r,unpack:o}}function r(e){return e[0]}var t="undefined"!=typeof Buffer?Buffer:function(){function e(e,r){r=r||1/0;for(var t=e.length,n=void 0,i=null,o=new Array,a=0;a<t;++a){if((n=e.charCodeAt(a))>55295&&n<57344){if(!i){if(n>56319){(r-=3)>-1&&o.push(239,191,189);continue}if(a+1===t){(r-=3)>-1&&o.push(239,191,189);continue}i=n;continue}if(n<56320){(r-=3)>-1&&o.push(239,191,189),i=n;continue}n=65536+(i-55296<<10|n-56320)}else i&&(r-=3)>-1&&o.push(239,191,189);if(i=null,n<128){if((r-=1)<0)break;o.push(n)}else if(n<2048){if((r-=2)<0)break;o.push(n>>6|192,63&n|128)}else if(n<65536){if((r-=3)<0)break;o.push(n>>12|224,n>>6&63|128,63&n|128)}else{if(!(n<1114112))throw new Error("Invalid code point");if((r-=4)<0)break;o.push(n>>18|240,n>>12&63|128,n>>6&63|128,63&n|128)}}return o}function r(e,r,t){t=Math.min(e.length,t);for(var n=new Array,i=r;i<t;){var o=e[i],a=null,s=o>239?4:o>223?3:o>191?2:1;if(i+s<=t){var c=void 0,f=void 0,l=void 0,y=void 0;switch(s){case 1:o<128&&(a=o);break;case 2:128==(192&(c=e[i+1]))&&(y=(31&o)<<6|63&c)>127&&(a=y);break;case 3:c=e[i+1],f=e[i+2],128==(192&c)&&128==(192&f)&&(y=(15&o)<<12|(63&c)<<6|63&f)>2047&&(y<55296||y>57343)&&(a=y);break;case 4:c=e[i+1],f=e[i+2],l=e[i+3],128==(192&c)&&128==(192&f)&&128==(192&l)&&(y=(15&o)<<18|(63&c)<<12|(63&f)<<6|63&l)>65535&&y<1114112&&(a=y)}}null===a?(a=65533,s=1):a>65535&&(a-=65536,n.push(a>>>10&1023|55296),a=56320|1023&a),n.push(a),i+=s}return u(n)}function t(e){if(e>c)throw new RangeError("Invalid typed array length");return new Uint8Array(e)}function n(r){return e(r).length}function i(e){var r=t(e);return r.write=o,r}function o(r,t,n){t=t||0;var i=this.length-t;return(!n||n>i)&&(n=i),a(e(r,this.length-t),this,t,n)}function a(e,r,t,n){var i=void 0;for(i=0;i<n&&!(i+t>=r.length||i>=e.length);++i)r[i+t]=e[i];return i}function u(e){var r=e.length;if(r<=s)return String.fromCharCode.apply(String,e);for(var t="",n=0;n<r;)t+=String.fromCharCode.apply(String,e.slice(n,n+=s));return t}var s=4096,c=2147483647,f=function(){};return f.alloc=i,f.byteLength=n,f.from=function(t){return"string"==typeof t?e(t):{toString:function(){return r(t,0,t.length)}}},f}();Uint8Array.prototype.slice||Object.defineProperty(Uint8Array.prototype,"slice",{value:Array.prototype.slice});var n=function(){var e=new Uint32Array([305419896]);return 18===new Uint8Array(e.buffer,e.byteOffset,e.byteLength)[0]}(),i=1;return{isBigEndian:n,createPacket:e,getId:r}}();e.exports=t;var n=function(){return function(e){if(null===e)e="";else switch(void 0===e?"undefined":_typeof(e)){case"string":break;case"undefined":e="";break;case"number":e=isNaN(e)?"":e+"";break;case"symbol":e=e.toString();break;default:e=JSON.stringify(e)}return e}}();return e.exports=n,function(e,i){function o(e,r){function n(e){a+=e}var i=r.data;if(e._emit("message",i,r),"string"!=typeof i){if(!e._emit("arraybuffer",i,r))for(var o=(i=new Uint8Array(i)).byteLength,a=0,u=i;a<o;){var s=c._unpackMapById[t.getId(u)];if(!s)break;var f=_slicedToArray(s,2),l=f[0],y=f[1].unpack(u,a,o,n);if(!y)break;o>a&&(u=i.slice(a)),e._emit("packet",l,y),e._emit(l,y)}}else e._emit("text",i,r)}function a(e,r){c.reconnecting&&(c.reconnecting=!1,c._emit("restored")),c._emit("open")}function u(e,r){var t=r.code,n=r.reason;c._emit("close",t,n,r),r.wasClean?c._emit("disconnected",t,n,r):(c._emit("terminated",t,r),setTimeout(function(){c.reconnecting=!0,c._reconnect(),c._emit("restoring")},2e3))}function s(e,r){c._emit("error",r)}var c=new(function(r){function i(){_classCallCheck(this,i);var r=_possibleConstructorReturn(this,(i.__proto__||Object.getPrototypeOf(i)).call(this));return e&&r.connect(e),r._packMapByName=new Map,r._unpackMapById=new Array,r.reconnecting=!1,r}return _inherits(i,r),_createClass(i,[{key:"isSupported",value:function(){return"undefined"!=typeof WebSocket}},{key:"emit",value:function(e,r){return(r=this._pack(e,r))&&this.send(r),!!r}},{key:"text",value:function(e){this.send(n(e))}},{key:"send",value:function(e){try{this._ws.send(e)}catch(e){this._emit("error",e)}}},{key:"connect",value:function(e){this._ws&&this._ws.close();var r=this._ws=new WebSocket(e);this.url=e,r.binaryType="arraybuffer",r.onmessage=o.bind(this,this),r.onopen=a.bind(this,this),r.onclose=u.bind(this,this),r.onerror=s.bind(this,this)}},{key:"disconnect",value:function(e,r){this._ws.close(e,r),this._ws=null}},{key:"packets",value:function(e,r,n){function i(e,r){e&&Object.keys(e).forEach(function(n){o(n),r(n,t.createPacket(e[n]))})}function o(e){if(["restoring","restored","open","close","disconnected","terminated","packet","message","arraybuffer","error"].some(function(r){return r===e}))throw new Error("Used a reserved name: "+e)}var a=this;return i(r,function(e,r){a._unpackMapById.push([e,r])}),i(e,function(e,r){a._packMapByName.set(e,[a._packMapByName.size,r])}),n?this.packets(n,n):this}},{key:"_reconnect",value:function(){return this.connect(this.url)}},{key:"_pack",value:function(e,r){var t=this._packMapByName.get(e);if(!t)return null;var n=_slicedToArray(t,2),i=n[0];return n[1].pack(i,r)}}]),i}(r));return c}}({});