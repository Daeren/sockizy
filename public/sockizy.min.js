"use strict";function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},_slicedToArray=function(){function e(e,t){var r=[],n=!0,i=!1,o=void 0;try{for(var a,s=e[Symbol.iterator]();!(n=(a=s.next()).done)&&(r.push(a.value),!t||r.length!==t);n=!0);}catch(e){i=!0,o=e}finally{try{!n&&s.return&&s.return()}finally{if(i)throw o}}return r}return function(t,r){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return e(t,r);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),_createClass=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),io=function(e){var t=function(){function e(e,t,r){if(t)e.call(r);else for(var n=0,i=e.length;n<i;++n)e[n].call(r)}function t(e,t,r,n){if(t)e.call(r,n);else for(var i=0,o=e.length;i<o;++i)e[i].call(r,n)}function r(e,t,r,n,i){if(t)e.call(r,n,i);else for(var o=0,a=e.length;o<a;++o)e[o].call(r,n,i)}function n(e,t,r,n,i,o){if(t)e.call(r,n,i,o);else for(var a=0,s=e.length;a<s;++a)e[a].call(r,n,i,o)}function i(e,t,r,n){if(t)e.apply(r,n);else for(var i=0,o=e.length;i<o;++i)e[i].apply(r,n)}return function(){function o(){_classCallCheck(this,o),this._events={}}return _createClass(o,[{key:"on",value:function(e,t){var r=this._events[e];return this._events[e]="function"==typeof r?[r,t]:r?this._arrayCloneWith(r,r.length,t):t,this}},{key:"off",value:function(e,t){var r=arguments.length;if(!r)return this._events={},this;var n=this._events[e];if("function"==typeof n)return 1!==r&&n!==t||(this._events[e]=null),this;var i=n&&n.length;return i?(1===r?1===i?n.pop():this._events[e]=new Array:1===i?n[0]===t&&n.pop():n.indexOf(t)>=0&&(this._events[e]=this._arrayCloneWithout(n,i,t)),this):this}},{key:"_emit",value:function(o){var a=this._events[o];if(!a){if("error"===o){var s=arguments[1];if(s instanceof Error)throw s;var c=new Error('Unhandled "error" event. ('+s+")");throw c.context=s,c}return!1}var u="function"==typeof a,f=arguments.length;switch(f){case 1:e(a,u,this);break;case 2:t(a,u,this,arguments[1]);break;case 3:r(a,u,this,arguments[1],arguments[2]);break;case 4:n(a,u,this,arguments[1],arguments[2],arguments[3]);break;default:for(var l=new Array(f-1),h=1;h<f;++h)l[h-1]=arguments[h];i(a,u,this,l)}return!0}},{key:"_arrayCloneWithout",value:function(e,t,r){for(var n=new Array(--t),i=void 0;t--;)r!==(i=e[t])&&(n[t]=i);return n}},{key:"_arrayCloneWith",value:function(e,t,r){for(var n=new Array(t+1);t--;)n[t]=e[t];return n[t]=r,n}}]),o}()}();e.exports=t;var r=function(){function e(e,t,o){function a(e,t){for(var r=Array.isArray(t),o=void 0,a=u,s=i,c=void 0,y=void 0,p=void 0,v=void 0,b=void 0,g=void 0,m=void 0,A=void 0,k=void 0;a--;){c=f[a];var E=_slicedToArray(c,7);switch(y=E[0],p=E[1],v=E[2],b=E[3],g=E[4],m=E[5],A=E[6],k=t[r?a:y],p){case w:if(k){var S=m.byteLength,T=k?b.write(k,S):0;m[0]=T,n?(b[0]=A[1],b[1]=A[0]):(b[0]=A[0],b[1]=A[1]),T+=S,g=b,b._blen=T,v=T}else g=h;break;default:b[0]=k,n&&b.byteLength>1&&g.reverse()}if(d)for(o=0;v--;)d[s++]=g[o++];else l[a]=g,s+=v}var C=d;if(!C)for(C=_&&_.length===s?_:_=new Uint8Array(s),a=u,o=i;a--;)for(var U=l[a],M=0,B=U._blen||U.length;M<B;++M)C[o++]=U[M];return C[0]=e,C}function s(e,r,a,s,c){if(c=c||(o?t?[]:{}:y),!e||"object"!==(void 0===e?"undefined":_typeof(e))||!v&&e.byteLength!==p||e.byteLength<p)return null;if(!u)return s&&s(i),c;for(var l=void 0,h=u,d=void 0,_=void 0,b=void 0,g=void 0,m=void 0,A=void 0,k=void 0,E=r+i,S=E;h--;){l=f[h];var T=_slicedToArray(l,7);d=T[0],_=T[1],b=T[2],g=T[3],m=T[4],A=T[5],k=T[6],t&&(d=h);for(var C=0;C<b;++C){if(E>=a)return null;A?k[C]=e[E++]:m[C]=e[E++]}switch(_){case w:n&&k.reverse();var U=A[0];if(!U||U>=a)c[d]="";else{for(var M=Math.min(g.length,U),B=0;B<M;++B)g[B]=e[E++];c[d]=g.toString("utf8",0,M)}break;default:n&&g.byteLength>1&&m.reverse(),c[d]=g[0]}}return s&&s(i+E-S),c}Array.isArray(e)||(e=new Array);for(var c,u=e.length,f=new Array(u),l=new Array(u),h=new Uint8Array(2),y=t?new Array:Object.create(null),p=0,v=!1,d=null,_=null,w=1,b=2,g=4,m=8,A=0;A<u;++A){var k=(c=e[A].split(":")).shift(),E=c.shift(),S=function(e){switch(e){case"s":case"str":return w;case"i":case"int":return b;case"u":case"uint":return g;case"f":case"float":return m;default:throw new Error("Unknown type: "+e)}}(E.replace(/[\d\[\]]/g,"")),T=function(e,t){switch(e){case w:return[Uint16Array.BYTES_PER_ELEMENT,r.alloc(t||256),new Uint16Array(1)];case b:switch(t){case 8:return[Int8Array.BYTES_PER_ELEMENT,new Int8Array(1)];case 16:return[Int16Array.BYTES_PER_ELEMENT,new Int16Array(1)];case 32:return[Int32Array.BYTES_PER_ELEMENT,new Int32Array(1)];default:throw new Error("Unknown size: "+t)}case g:switch(t){case 8:return[Uint8Array.BYTES_PER_ELEMENT,new Uint8Array(1)];case 16:return[Uint16Array.BYTES_PER_ELEMENT,new Uint16Array(1)];case 32:return[Uint32Array.BYTES_PER_ELEMENT,new Uint32Array(1)];default:throw new Error("Unknown size: "+t)}case m:switch(t){case 32:return[Float32Array.BYTES_PER_ELEMENT,new Float32Array(1)];case 64:return[Float64Array.BYTES_PER_ELEMENT,new Float64Array(1)];default:throw new Error("Unknown size: "+t)}default:throw new Error("Unknown type: "+e)}}(S,parseInt(E.replace(/\D/g,""),10)||0),C=_slicedToArray(T,3),U=C[0],M=C[1],B=C[2],L=w&S?null:new Uint8Array(M.buffer),N=B?new Uint8Array(B.buffer):null;f[A]=[k,S,U,M,L,B,N],p+=U,!v&&w&S&&(v=!0)}return p+=i,v||(d=new Uint8Array(p)),{pack:a,unpack:s}}function t(e){return e[0]}var r="undefined"!=typeof Buffer?Buffer:function(){function e(e,t){t=t||1/0;for(var r=e.length,n=void 0,i=null,o=new Array,a=0;a<r;++a){if((n=e.charCodeAt(a))>55295&&n<57344){if(!i){if(n>56319){(t-=3)>-1&&o.push(239,191,189);continue}if(a+1===r){(t-=3)>-1&&o.push(239,191,189);continue}i=n;continue}if(n<56320){(t-=3)>-1&&o.push(239,191,189),i=n;continue}n=65536+(i-55296<<10|n-56320)}else i&&(t-=3)>-1&&o.push(239,191,189);if(i=null,n<128){if((t-=1)<0)break;o.push(n)}else if(n<2048){if((t-=2)<0)break;o.push(n>>6|192,63&n|128)}else if(n<65536){if((t-=3)<0)break;o.push(n>>12|224,n>>6&63|128,63&n|128)}else{if(!(n<1114112))throw new Error("Invalid code point");if((t-=4)<0)break;o.push(n>>18|240,n>>12&63|128,n>>6&63|128,63&n|128)}}return o}function t(e,t,r){r=Math.min(e.length,r);for(var n=new Array,i=t;i<r;){var o=e[i],a=null,c=o>239?4:o>223?3:o>191?2:1;if(i+c<=r){var u=void 0,f=void 0,l=void 0,h=void 0;switch(c){case 1:o<128&&(a=o);break;case 2:128==(192&(u=e[i+1]))&&(h=(31&o)<<6|63&u)>127&&(a=h);break;case 3:u=e[i+1],f=e[i+2],128==(192&u)&&128==(192&f)&&(h=(15&o)<<12|(63&u)<<6|63&f)>2047&&(h<55296||h>57343)&&(a=h);break;case 4:u=e[i+1],f=e[i+2],l=e[i+3],128==(192&u)&&128==(192&f)&&128==(192&l)&&(h=(15&o)<<18|(63&u)<<12|(63&f)<<6|63&l)>65535&&h<1114112&&(a=h)}}null===a?(a=65533,c=1):a>65535&&(a-=65536,n.push(a>>>10&1023|55296),a=56320|1023&a),n.push(a),i+=c}return s(n)}function r(e){if(e>u)throw new RangeError("Invalid typed array length");var t=new Uint8Array(e);return t.write=f.prototype.write,t.toString=f.prototype.toString,t}function n(t){return e(t).length}function i(e){return r(e)}function o(t,r,n){r=r||0,n=n||this.length;var i=this.length-r;return(!n||n>i)&&(n=i),a(e(t,this.length-r),this,r,n)}function a(e,t,r,n){var i=void 0;for(i=0;i<n&&!(i+r>=t.length||i>=e.length);++i)t[i+r]=e[i];return i}function s(e){var t=e.length;if(t<=c)return String.fromCharCode.apply(String,e);for(var r="",n=0;n<t;)r+=String.fromCharCode.apply(String,e.slice(n,n+=c));return r}var c=4096,u=2147483647,f=function(){};return f.alloc=i,f.byteLength=n,f.prototype=Object.create(null),f.prototype.write=o,f.prototype.toString=function(e,r,n){return r=r||0,n=n||this.length,0===n?"":t(this,r,n)},f}();Uint8Array.prototype.slice||Object.defineProperty(Uint8Array.prototype,"slice",{value:Array.prototype.slice});var n=function(){var e=new Uint32Array([305419896]);return 18===new Uint8Array(e.buffer,e.byteOffset,e.byteLength)[0]}(),i=1;return{isBigEndian:n,createPacket:e,getId:t}}();e.exports=r;var n=function(){return function(e){if(null===e)return"";switch(void 0===e?"undefined":_typeof(e)){case"string":return e;case"undefined":return"";case"number":return isNaN(e)?"":e+"";case"symbol":return e.toString();default:return JSON.stringify(e)}}}();return e.exports=n,function(e){function i(e,t){function n(e){a+=e}var i=t.data;if(e._emit("message",i,t),"string"!=typeof i){if(!e._emit("arraybuffer",i,t))for(var o=(i=new Uint8Array(i)).byteLength,a=0,s=i;a<o;){var c=this._unpackMapById[r.getId(s)];if(!c)break;var u=_slicedToArray(c,2),f=u[0],l=u[1].unpack(s,a,o,n);if(!l)break;o>a&&(s=i.slice(a)),e._emit("packet",f,l),e._emit(f,l)}}else e._emit("text",i,t)}function o(e,t){var r=this._reconnectionAttemptsCount;this._reconnectionAttemptsCount=0,this.reconnecting&&(this.reconnecting=!1,this._emit("restored",r)),this._emit("open")}function a(e,t){var r=this,n=t.code,i=t.reason;if(this._emit("close",n,i,t),t.wasClean)this._emit("disconnected",n,i,t);else{var o=this._reconnectionAttemptsCount;this._emit("terminated",n,t),o<this._reconnectionAttempts?(this._reconnectionAttemptsCount++,setTimeout(function(){r.reconnecting=!0,r._reconnect(),r._emit("restoring",o)},this._reconnectionDelay)):(this.reconnecting=!1,this._emit("unrestored",o))}}function s(e,t){this._emit("error",t)}var c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return new(function(t){function u(){_classCallCheck(this,u);var t=_possibleConstructorReturn(this,(u.__proto__||Object.getPrototypeOf(u)).call(this));return t._reconnectionDelay=1e3*Math.max(1,c.reconnectionDelay||0),t._reconnectionAttempts=c.reconnectionAttempts||1/0,t._reconnectionAttemptsCount=0,t._packMapByName=new Map,t._unpackMapById=new Array,t.reconnecting=!1,e&&t.connect(e,c.secure),t}return _inherits(u,t),_createClass(u,[{key:"isSupported",value:function(){return"undefined"!=typeof WebSocket}},{key:"emit",value:function(e,t){return(t=this._pack(e,t))&&this.send(t),!!t}},{key:"text",value:function(e){this.send(n(e))}},{key:"send",value:function(e){try{this._ws.send(e)}catch(e){this._emit("error",e)}}},{key:"connect",value:function(e,t){this._ws&&this._ws.close();var r=e.trim().split(/(^wss?:\/\/)/i),n=r.pop().replace(/^[:\/\/]*/,""),c=r.pop().trim(),u=!(!c||!c.match(/^wss:\/\//i));void 0===t&&(t=c?u:!!document.location.protocol.match(/^https/i));var f=this._ws=new WebSocket((t?"wss":"ws")+"://"+n);return f.binaryType="arraybuffer",f.onmessage=i.bind(this,this),f.onopen=o.bind(this,this),f.onclose=a.bind(this,this),f.onerror=s.bind(this,this),this}},{key:"disconnect",value:function(e,t){return this._ws.close(e,t),this._ws=null,this}},{key:"packets",value:function(e,t,n){function i(e,t){e&&Object.keys(e).forEach(function(n){var i=n.split(/\(([\[\{]?)(\@?)([\}\]]?)\)$/),a=void 0,s=void 0,c=void 0;a=i.shift().trim(),s="["===i.shift(),c="@"===i.shift(),o(a),t(a,r.createPacket(e[n],s,c))})}function o(e){if(["restoring","restored","open","close","disconnected","terminated","packet","message","arraybuffer","error","ping","pong"].some(function(t){return t===e}))throw new Error("Used a reserved name: "+e)}var a=this;return i(t,function(e,t){a._unpackMapById.push([e,t])}),i(e,function(e,t){a._packMapByName.set(e,[a._packMapByName.size,t])}),n?this.packets(n,n):this}},{key:"_reconnect",value:function(){return this.connect(this.url)}},{key:"_pack",value:function(e,t){var r=this._packMapByName.get(e);if(!r)return null;var n=_slicedToArray(r,2),i=n[0];return n[1].pack(i,t)}},{key:"bufferedAmount",get:function(){return this._ws.bufferedAmount}},{key:"readyState",get:function(){return this._ws.readyState}},{key:"url",get:function(){return this._ws.url}}]),u}(t))}}({});